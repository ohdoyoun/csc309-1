var Controller = (new function (){
	var self = this;
	self.urls = {};
	self.pageModel = null;
	self.navigation = new NavigationModel();
		
	self.init = function(properties)
	{
		self.pageModel = new PageModel(properties.pageModel);
		self.urls = properties.urls;
		self.navigation.init();
		var isAuthed = $("#is-authed").attr("data-value") === '1';
		self.navigation.changeCurrentNavigationType(isAuthed ? 0 : 1 );
		self.setupCurrentNavMenu();
		
		ko.applyBindings(self.navigation, document.getElementById("navigation"));
		ko.applyBindings(self.navigation, document.getElementById("header"));
		
		
	},
	
	self.setupCurrentNavMenu = function(){
		
		$.each(self.navigation.navigation, function(index, value){
			$.each(value, function(innerIndex, innerValue){
				if(innerValue.content){
					if(innerValue.content.indexOf("{pId}") !== -1){
						var contentPathArray = innerValue.content.split( '/' );
						var pathArray = window.location.pathname.split( '/' );
						if(contentPathArray.length === pathArray.length){
							var pidIndex = contentPathArray.indexOf("{pId}");
							self.navigation.currentPid(pathArray[pidIndex]);
						}else{ self.navigation.currentPid(-1);}
					}
					if(window.location.pathname.indexOf(innerValue.content.replace("{pId}",self.navigation.currentPid() )) === 0){
						self.navigation.changeCurrentNavigation(index);
						return;
					}
				}
			});
		});
		
	}

}());